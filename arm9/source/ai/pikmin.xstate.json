{
  "id": "pikmin",
  "initial": "selectSpawnMode",
  "states": {
    "selectSpawnMode": {
      "on": {
        "": [
          {"cond": "deployingFromOnion", "target": "deployingFromOnion"},
          {"cond": "dispersedAsSeed", "target": "vegetative"},
          {"cond": "planted", "target": "vegetative.planted"},
          {"cond": "wild", "target": "independent"}
        ]
      }
    },
    "deployingFromOnion": {
      "on": {
        "WHISTLED": "squadMember",
        "LAST_FRAME": "squadMember"
      }
    },
    "vegetative": {
      "initial": "dispersing",
      "states": {
        "dispersing": {
          "on": {
            "LANDED": "sprouting"
          }
        },
        "sprouting": {
          "on": {
            "LAST_FRAME": "planted"
          }
        },
        "planted": {
          "on": {
            "PULLED_ON": "plucking",
            "WHISTLED": {
              "cond": "withPluckophone",
              "target": "springFromTheGround"
            }
          },
        },
        "plucking": {
          "on": {
            "LAST_FRAME": "#pikmin.squadMember"
          }
        },
        "springFromTheGround": {
          "on": {
            "LAST_FRAME": "#pikmin.squadMember"
          }
        },
      },
    },
    "independent": {
      "initial": "loitering",
      "on": {
        "WHISTLED": "squadMember"
      },
      "states": {
        "loitering": {
          "on": {
            "NEAR_THREAT": "hunting",
            "NEAR_TREASURE": "looting"
          }
        },
        "hunting": {
          "initial": "closingDistance",
          "on": {
            "THREAT_NEUTRALIZED": "loitering",
            "UNABLE_TO_REACH_TARGET": "loitering"
          },
          "states": {
            "closingDistance": {
              "on": {
                "THREAT_IN_RANGE": "aiming"
              }
            },
            "aiming": {
              "entry": "aim",
              "on": {
                "LAST_FRAME": "lunge"
              }
            },
            "lunge": {
              "entry": "lungeAttack",
              "on": {
                "LANDED": "closingDistance"
              }
            }
          }
        },
        "looting": {
          "initial": "descendingOnTreasure",
          "on": {
            "TREASURE_INVALID": "loitering"
          },
          "states": {
            "descendingOnTreasure": {
              "on": {
                "TOUCHED_TREASURE": {
                  "cond": "carrySlotAvailable",
                  "target": "lift"
                }
              }
            },
            "lift": {
              "on": {
                "TREASURE_MOVING": "carry"
              }
            },
            "carry": {
              "on": {
                "TREASURE_STOPPED": "lift"
              }
            }
          }
        },
      }
    },
    "squadMember": {
      "initial": "marching",
      "states": {
        "marching": {
          "on": {
            "GRABBED": "grabbed",
            "PUT_AWAY": "#pikmin.retiringToOnion"
          }
        },
        "grabbed": {
          "on": {
            "THROWN": "sailingThroughTheAir"
          }
        },
        "sailingThroughTheAir": {
          "on": {
            "LANDED": "#pikmin.independent"
          }
        }
      }
    },
    "retiringToOnion": {
      "initial": "movingToOnionFoot",
      "states": {
        "movingToOnionFoot": {
          "on": {
            "TOUCHED_ONION_FOOT": "climbOnionLeg"
          }
        },
        "climbOnionLeg": {
          "on": {
            "REACHED_ONION_BODY": "climbIntoOnion"
          }
        },
        "climbIntoOnion": {
          "type": "final"
        }
      }
    }
  }
}